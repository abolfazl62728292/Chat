<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sno Chat | اسنو‌چت</title>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- KaTeX برای نمایش فرمول‌های ریاضی -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" integrity="sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFfFr4dgmgccOTx" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="chat.css">    
    <!-- Prism.js -->
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
</head>
<body>
    <div class="overlay" id="overlay"></div>

    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <button class="logout-btn" id="logoutBtn" style="background: rgba(255, 71, 87, 0.1); border: 1px solid rgba(255, 71, 87, 0.3); border-radius: 12px; color: #ff4757; font-weight: 500; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; align-items: center; gap: 10px; font-family: 'Vazirmatn', sans-serif; text-decoration: none; font-size: 14px; padding: 12px 16px; width: 100%;">
                    <i class="fas fa-sign-out-alt"></i>
                    خروج
                </button>
            </div>

            <div class="user-info">
                <div class="user-name" id="userName">کاربر</div>
                <div class="credits-display">
                    <i class="fas fa-coins"></i>
                    <span id="creditsCount">0</span>
                    <span>اعتبار</span>
                </div>
            </div>

            <button class="new-chat-btn" id="newChatBtn">
                <i class="fas fa-plus"></i>
                چت جدید
            </button>

            <div class="sidebar-content">
                <a href="/sno/settings" class="settings-btn">
                    <i class="fas fa-cog"></i>
                    تنظیمات
                </a>

                <div class="sessions-list" id="sessionsList">
                    <!-- Sessions will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="chat-container">
            <div class="chat-header">
                <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                    <button class="mobile-menu-btn" id="mobileMenuBtn">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="chat-title" id="chatTitle">SnoChat</div>
                </div>
            </div>

            <div class="credits-warning" id="creditsWarning">
                اعتبار شما کافی نیست! برای ادامه چت نیاز به حداقل ۱ اعتبار دارید.
            </div>

            <div class="messages-container" id="messagesContainer">
                <div class="empty-chat" id="emptyChat">
                    <div class="empty-chat-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="empty-chat-text">
                        <h3>چطور می‌تونم کمکتون کنم؟</h3>
                        <p>پیام خود را تایپ کنید و با هوش مصنوعی گفتگو کنید. چت جدید به صورت خودکار ایجاد می‌شود.</p>
                    </div>
                </div>

                <div class="typing-indicator" id="typingIndicator">
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            </div>

            <div class="input-container">
                <div class="input-wrapper">
                    <div class="message-input-wrapper">
                        <textarea class="message-input" id="messageInput" placeholder="پیام خود را اینجا بنویسید..." rows="1" maxlength="2000"></textarea>
                        <div class="input-actions">
                            <button class="send-btn" id="sendBtn" title="ارسال پیام">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                            <button class="attach-btn" id="attachBtn" title="ارسال تصویر">
                                <i class="fas fa-image"></i>
                            </button>
                        </div>
                    </div>
                    <input type="file" id="imageInput" accept="image/*" style="display: none;">
                </div>
                <div id="imagePreview" class="image-preview" style="display: none;">
                    <div class="image-preview-content">
                        <img id="previewImg" src="" alt="پیش‌نمایش تصویر">
                        <button class="remove-image-btn" id="removeImageBtn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Title Edit Modal -->
    <div class="modal-overlay" id="titleModal">
        <div class="modal">
            <h3>ویرایش عنوان</h3>
            <input type="text" class="modal-input" id="titleInput" placeholder="عنوان جدید را وارد کنید">
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelBtn">لغو</button>
                <button class="modal-btn primary" id="saveBtn">ذخیره</button>
            </div>
        </div>
    </div>

    <!-- Delete Session Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal">
            <div class="modal-icon delete-icon">
                <i class="fas fa-trash-alt"></i>
            </div>
            <h3>حذف چت</h3>
            <p class="modal-message">آیا از حذف این چت اطمینان دارید؟ این عمل قابل بازگردانی نیست.</p>
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelDeleteBtn">لغو</button>
                <button class="modal-btn danger" id="confirmDeleteBtn">حذف</button>
            </div>
        </div>
    </div>

    <!-- Logout Modal -->
    <div class="modal-overlay" id="logoutModal">
        <div class="modal">
            <div class="modal-icon logout-icon">
                <i class="fas fa-sign-out-alt"></i>
            </div>
            <h3>خروج از حساب</h3>
            <p class="modal-message">آیا از خروج از حساب کاربری خود اطمینان دارید؟</p>
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelLogoutBtn">لغو</button>
                <button class="modal-btn danger" id="confirmLogoutBtn">خروج</button>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div class="modal-overlay" id="imageModal">
        <div class="image-modal-content">
            <button class="close-image-modal" id="closeImageModal">
                <i class="fas fa-times"></i>
            </button>
            <img id="modalImage" src="" alt="تصویر کامل">
        </div>
    </div>

    <script src="messageRenderer.js"></script>
    <script src="chat.js"></script>
</body>
</html>